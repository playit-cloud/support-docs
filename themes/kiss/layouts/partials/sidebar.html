{{ $allPages := where .Site.RegularPages "Params.hidden" "ne" true }}
{{ $currentPage := . }}

<aside class="w-64 border-r border-terminal-green/30 dark:border-terminal-green/20 bg-white dark:bg-[#141a17] overflow-y-auto">
  <div class="p-4 space-y-6">
    <!-- Search -->
    <div class="relative">
      <input 
        type="text" 
        id="search-input"
        placeholder="$ search docs..."
        class="w-full px-3 py-2 bg-[#f5f7f6] dark:bg-[#0a0f0d] border border-terminal-green/30 dark:border-terminal-green/20 rounded text-sm focus:outline-none focus:border-[#16a34a] dark:focus:border-terminal-green focus:ring-1 focus:ring-[#16a34a] dark:focus:ring-terminal-green"
      />
      <div id="search-results" class="hidden absolute top-full left-0 right-0 mt-1 bg-white dark:bg-[#141a17] border border-terminal-green/30 dark:border-terminal-green/20 rounded shadow-lg z-50 max-h-96 overflow-y-auto"></div>
    </div>

    <!-- Minecraft -->
    {{ $minecraft := where $allPages "Params.tags" "intersect" (slice "minecraft") }}
    {{ if $minecraft }}
    <div>
      <h2 class="text-xs font-heading font-semibold text-[#16a34a] dark:text-terminal-green uppercase tracking-wider mb-2">Minecraft</h2>
      <ul class="space-y-1">
        {{ range $minecraft }}
        <li>
          <a href="{{ .RelPermalink }}" class="block px-2 py-1 text-sm {{ if eq $currentPage.RelPermalink .RelPermalink }}text-[#16a34a] dark:text-terminal-green bg-terminal-green/5 dark:bg-terminal-green/10 border-l-2 border-[#16a34a] dark:border-terminal-green{{ else }}text-[#1a1f1c]/70 dark:text-[#e0e6e3]/70 hover:text-[#16a34a] dark:hover:text-terminal-green hover:bg-terminal-green/5{{ end }} transition-colors">
            {{ .Title }}
          </a>
        </li>
        {{ end }}
      </ul>
    </div>
    {{ end }}

    <!-- Platforms -->
    {{ $platforms := where $allPages "Params.tags" "intersect" (slice "windows" "linux" "macos") }}
    {{ if $platforms }}
    <div>
      <h2 class="text-xs font-heading font-semibold text-[#16a34a] dark:text-terminal-green uppercase tracking-wider mb-2">Platforms</h2>
      <ul class="space-y-1">
        {{ range $platforms }}
        <li>
          <a href="{{ .RelPermalink }}" class="block px-2 py-1 text-sm {{ if eq $currentPage.RelPermalink .RelPermalink }}text-[#16a34a] dark:text-terminal-green bg-terminal-green/5 dark:bg-terminal-green/10 border-l-2 border-[#16a34a] dark:border-terminal-green{{ else }}text-[#1a1f1c]/70 dark:text-[#e0e6e3]/70 hover:text-[#16a34a] dark:hover:text-terminal-green hover:bg-terminal-green/5{{ end }} transition-colors">
            {{ .Title }}
          </a>
        </li>
        {{ end }}
      </ul>
    </div>
    {{ end }}

    <!-- Networking -->
    {{ $networking := where $allPages "Params.tags" "intersect" (slice "dns" "proxy-protocol" "port forwarding" "networking" "how it works") }}
    {{ if $networking }}
    <div>
      <h2 class="text-xs font-heading font-semibold text-[#16a34a] dark:text-terminal-green uppercase tracking-wider mb-2">Networking</h2>
      <ul class="space-y-1">
        {{ range $networking }}
        <li>
          <a href="{{ .RelPermalink }}" class="block px-2 py-1 text-sm {{ if eq $currentPage.RelPermalink .RelPermalink }}text-[#16a34a] dark:text-terminal-green bg-terminal-green/5 dark:bg-terminal-green/10 border-l-2 border-[#16a34a] dark:border-terminal-green{{ else }}text-[#1a1f1c]/70 dark:text-[#e0e6e3]/70 hover:text-[#16a34a] dark:hover:text-terminal-green hover:bg-terminal-green/5{{ end }} transition-colors">
            {{ .Title }}
          </a>
        </li>
        {{ end }}
      </ul>
    </div>
    {{ end }}

    <!-- playit.gg -->
    {{ $playit := where $allPages "Params.tags" "intersect" (slice "playit" "playit.gg") }}
    {{ if $playit }}
    <div>
      <h2 class="text-xs font-heading font-semibold text-[#16a34a] dark:text-terminal-green uppercase tracking-wider mb-2">playit.gg</h2>
      <ul class="space-y-1">
        {{ range $playit }}
        <li>
          <a href="{{ .RelPermalink }}" class="block px-2 py-1 text-sm {{ if eq $currentPage.RelPermalink .RelPermalink }}text-[#16a34a] dark:text-terminal-green bg-terminal-green/5 dark:bg-terminal-green/10 border-l-2 border-[#16a34a] dark:border-terminal-green{{ else }}text-[#1a1f1c]/70 dark:text-[#e0e6e3]/70 hover:text-[#16a34a] dark:hover:text-terminal-green hover:bg-terminal-green/5{{ end }} transition-colors">
            {{ .Title }}
          </a>
        </li>
        {{ end }}
      </ul>
    </div>
    {{ end }}

    <!-- External Domain -->
    {{ $externalDomain := where $allPages "Params.tags" "intersect" (slice "external-domain") }}
    {{ if $externalDomain }}
    <div>
      <h2 class="text-xs font-heading font-semibold text-[#16a34a] dark:text-terminal-green uppercase tracking-wider mb-2">External Domain</h2>
      <ul class="space-y-1">
        {{ range $externalDomain }}
        <li>
          <a href="{{ .RelPermalink }}" class="block px-2 py-1 text-sm {{ if eq $currentPage.RelPermalink .RelPermalink }}text-[#16a34a] dark:text-terminal-green bg-terminal-green/5 dark:bg-terminal-green/10 border-l-2 border-[#16a34a] dark:border-terminal-green{{ else }}text-[#1a1f1c]/70 dark:text-[#e0e6e3]/70 hover:text-[#16a34a] dark:hover:text-terminal-green hover:bg-terminal-green/5{{ end }} transition-colors">
            {{ .Title }}
          </a>
        </li>
        {{ end }}
      </ul>
    </div>
    {{ end }}

    <!-- Guides -->
    {{ $guides := where $allPages "Params.tags" "intersect" (slice "guide") }}
    {{ if $guides }}
    <div>
      <h2 class="text-xs font-heading font-semibold text-[#16a34a] dark:text-terminal-green uppercase tracking-wider mb-2">Guides</h2>
      <ul class="space-y-1">
        {{ range $guides }}
        <li>
          <a href="{{ .RelPermalink }}" class="block px-2 py-1 text-sm {{ if eq $currentPage.RelPermalink .RelPermalink }}text-[#16a34a] dark:text-terminal-green bg-terminal-green/5 dark:bg-terminal-green/10 border-l-2 border-[#16a34a] dark:border-terminal-green{{ else }}text-[#1a1f1c]/70 dark:text-[#e0e6e3]/70 hover:text-[#16a34a] dark:hover:text-terminal-green hover:bg-terminal-green/5{{ end }} transition-colors">
            {{ .Title }}
          </a>
        </li>
        {{ end }}
      </ul>
    </div>
    {{ end }}

    <!-- Other -->
    {{ $categoryTags := slice "minecraft" "windows" "linux" "macos" "dns" "proxy-protocol" "port forwarding" "networking" "how it works" "playit" "playit.gg" "external-domain" "guide" }}
    {{ $others := slice }}
    {{ range $allPages }}
      {{ $hasCategoryTag := false }}
      {{ if .Params.tags }}
        {{ range .Params.tags }}
          {{ if in $categoryTags . }}
            {{ $hasCategoryTag = true }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ if not $hasCategoryTag }}
        {{ $others = $others | append . }}
      {{ end }}
    {{ end }}
    {{ if $others }}
    <div>
      <h2 class="text-xs font-heading font-semibold text-[#16a34a] dark:text-terminal-green uppercase tracking-wider mb-2">Other</h2>
      <ul class="space-y-1">
        {{ range $others }}
        <li>
          <a href="{{ .RelPermalink }}" class="block px-2 py-1 text-sm {{ if eq $currentPage.RelPermalink .RelPermalink }}text-[#16a34a] dark:text-terminal-green bg-terminal-green/5 dark:bg-terminal-green/10 border-l-2 border-[#16a34a] dark:border-terminal-green{{ else }}text-[#1a1f1c]/70 dark:text-[#e0e6e3]/70 hover:text-[#16a34a] dark:hover:text-terminal-green hover:bg-terminal-green/5{{ end }} transition-colors">
            {{ .Title }}
          </a>
        </li>
        {{ end }}
      </ul>
    </div>
    {{ end }}
  </div>
</aside>